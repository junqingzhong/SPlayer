# Environment Setup and Configuration

This document provides instructions and information on setting up the development environment for SPlayer and understanding its configuration.

## Core Requirements

-   **Node.js**: Version `>=20` is required (as specified in `package.json`).
    -   *Note*: The recent updates (including proxy settings) were developed in an environment with Node.js v18.19.1. While the application builds and runs, full compatibility (especially regarding TypeScript type checking for `electron-store`) is best achieved with Node.js v20 or higher.
-   **Package Manager**: `pnpm` is the recommended package manager for this project.
    -   Install `pnpm` if you haven't already (e.g., `npm install -g pnpm`).
    -   Project dependencies should be installed using `pnpm install`.

## Environment Variables

The application uses environment variables for certain configurations, primarily for development. These can be set in a `.env` file in the project root (this file is gitignored). See `.env.example` for a template.

-   `VITE_WEB_PORT`: Defines the port for the Vite development server that serves the renderer process (frontend).
    -   Default: `14558`
-   `VITE_SERVER_PORT`: Defines the port for the local Fastify API server (backend) that interfaces with music services.
    -   Default: `25884`
-   `VITE_API_URL`: The base path for frontend calls to the Netease part of the backend API.
    -   Default: `/api/netease`

## Key Scripts (run with `pnpm <script_name>`)

-   `dev`: Starts the application in development mode with hot reloading.
    -   Command: `electron-vite dev`
-   `build`: Builds the application for production. This includes type checking and then using `electron-vite build`.
    -   Command: `npm run typecheck && electron-vite build`
-   `typecheck`: Runs TypeScript type checking for both Node.js and web code.
-   `lint`: Lints the codebase using ESLint and attempts to fix issues.
-   `format`: Formats the code using Prettier.
-   `start`: Runs `electron-vite preview` (typically for previewing a production build locally).

For platform-specific builds (Windows, macOS, Linux), use:
-   `build:win`
-   `build:mac`
-   `build:linux`

## Application Configuration

### Proxy Settings

-   SPlayer allows users to configure network proxy settings directly within the application (Settings > Other Settings > Network Proxy).
-   Available proxy types include: Off, System Proxy, Manual (HTTP/HTTPS server, port, optional username/password), and PAC URL.
-   These settings are persisted locally on the user's machine using `electron-store`. The configuration structure is defined in `electron/main/store.ts` under `proxyConfig`.

### Main Configuration Files

-   **`package.json`**: Lists all project dependencies, devDependencies, and scripts. Defines required Node.js and npm versions.
-   **`pnpm-lock.yaml`**: Auto-generated by `pnpm` to lock down dependency versions.
-   **`electron.vite.config.ts`**: Configuration for `electron-vite`, which handles the build and development process for Electron main, preload, and renderer (Vue.js) code. It defines port numbers, development server proxies, build optimizations, and aliases.
-   **`electron-builder.yml`**: Configuration file for `electron-builder`, which packages the application into distributable formats for different operating systems. (Content not detailed here, but it's a standard part of Electron app deployment).
-   **`tsconfig.json`, `tsconfig.node.json`, `tsconfig.web.json`**: TypeScript configuration files for different parts of the project.
-   **`electron/main/store.ts`**: Defines the schema for user-specific settings that are persisted locally (e.g., window size, lyric preferences, proxy configuration). The actual storage location is OS-dependent (e.g., `~/.config/splayer/config.json` on Linux, `%APPDATA%/splayer/config.json` on Windows).
